<template>
  <PhoneFrame :current-time="currentTime">
      <!-- ä¸»å†…å®¹åŒº -->
      <div class="main-content">
        <!-- èŠå¤© tab -->
        <div id="chatTab" :class="['tab-content', { active: activeTab === 'chatTab' }]">
          <div id="contactList" :class="['sub-view', { active: currentView === 'contactList' }]">
            <div class="header">
              <button class="back-to-phone-btn" @click="goBackToPhone">â†</button>
              <h2>èŠå¤©</h2>
            </div>
            <div class="contact-list">
              <div class="contact-item" @click="openChat('çˆ±ç¡è§‰çš„æ°´é¥º')">
                <div class="avatar">ğŸ¥Ÿ</div>
                <div class="contact-info">
                  <div class="name">çˆ±ç¡è§‰çš„æ°´é¥º</div>
                  <div class="last-message">ä¸ä¼šæ˜¯å‡ºäº‹äº†å§â€¦â€¦</div>
                </div>
              </div>
            </div>
          </div>

          <div id="chatView" :class="['sub-view', { active: currentView === 'chatView' }]">
            <div class="chat-header">
              <button class="back-btn" @click="goBackToContacts">â†</button>
              <div class="contact-name">çˆ±ç¡è§‰çš„æ°´é¥º</div>
            </div>
            <div class="chat-container">
              <TimeDivider time="11/15 13:24" />
              <ChatMessage type="received" content="æˆ‘æ¬æ–°å®¶å•¦ï¼è¿™è¾¹æŒºå®‰é™çš„ï¼Œå¯ä»¥ä¸“å¿ƒåˆ›ä½œï¼" />
              <ChatMessage type="sent" content="ä¸é”™å•Šï¼Œä½†ä¹Ÿè¦æ³¨æ„è‡ªèº«å®‰å…¨å“¦ã€‚" />
              <ChatMessage type="received" content="å—¯å—¯ï¼" />
              <ChatMessage type="sent" content="æ¥ä¸€æŠŠï¼Ÿ" />
              <ChatMessage type="received" content="æ¥ï¼" />

              <TimeDivider time="11/17 21:00" />
              <ChatMessage type="received" content="å¯¹äº†ï¼Œä½ ä¸æ˜¯å¯¹å¯†ç å­¦æ„Ÿå…´è¶£å—ï¼Œæˆ‘è¿™æœ‰ä¸€ä¸ªå¯†ç ï¼Œä½ çŒœçŒœçœ‹ï¼Ÿ" />
              <ChatMessage type="received" :content="mimatuImage" :is-image="true" alt="å¯†ç å›¾ç‰‡" />
              <ChatMessage type="sent" content="å¥½ä¸‘â€¦â€¦æ€ä¹ˆéƒ½2025å¹´äº†è¿˜æœ‰è€è‰ºæœ¯å®¶åšæŒæ‰‹æ“â€¦â€¦" />
              <ChatMessage type="received" content="ä½ åˆ«ç®¡ï¼Œç®—äº†ï¼Œç»™ä½ ä¸ªæç¤ºâ€”â€”ä½ çš„å®¶ï¼Œå“ˆå“ˆï¼" />
              <ChatMessage type="sent" content="â€¦â€¦å¥½å§ï¼Œè™½ç„¶æœ‰è¢«å†’çŠ¯åˆ°ï¼Œä½†æˆ‘åº”è¯¥çŸ¥é“äº†ã€‚" />
              <ChatMessage type="received" content="å˜»å˜»ã€‚" />
              <ChatMessage type="sent" content="è¿™è¿˜æŒºæœ‰æ„æ€çš„ï¼Œæˆ‘æŠŠç­”æ¡ˆè®¾æˆç”µå­é‚®ç®±çš„å¯†ç äº†ã€‚" />

              <TimeDivider time="11/19 18:21" />
              <ChatMessage type="received" content="æœ€è¿‘æ„Ÿè§‰å¥½å€’éœ‰â€¦â€¦" />
              <ChatMessage type="sent" content="æ¸¸æˆæ²»æ„ˆä¸€åˆ‡ï¼ä¸Šå·!" />
              <ChatMessage type="received" content="å“¼ï¼Œä½ ä¸ªæ¸¸æˆè„‘è¢‹ï¼Œè·Ÿä½ ä¹Ÿè¯´ä¸æ˜ç™½ã€‚" />

              <TimeDivider time="11/29 20:00" />
              <ChatMessage type="sent" content="æœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿæˆ‘çœ‹ä½ éƒ½æ²¡ä¸Šå·ã€‚" />
              <ChatMessage type="received" content="æœ‰ç‚¹ä¸å¤ªå¥½â€¦â€¦ç®—äº†ï¼Œå¯èƒ½æ˜¯æˆ‘å¤ªæ•æ„Ÿäº†â€¦â€¦å°±æ˜¯èº«ä½“æœ‰ç‚¹ä¸èˆ’æœè€Œå·²ã€‚" />
              <ChatMessage type="sent" content="ç»™ä½ å¯„äº†ç‚¹æš–èº«èŒ¶ï¼Œè®°å¾—ç­¾æ”¶å•Šã€‚" />
              <ChatMessage type="received" content="â€¦â€¦è°¢è°¢ã€‚" />

              <TimeDivider time="12/02 19:45" />
              <ChatMessage type="sent" content="èº«ä½“æ€ä¹ˆæ ·äº†ï¼Ÿ" />

              <TimeDivider time="12/03 20:01" />
              <ChatMessage type="sent" content="ä½ è¿˜å¥½å—ï¼Ÿ" />
              <ChatMessage type="sent" content="æ€ä¹ˆä¸å›æ¶ˆæ¯ï¼Ÿ" />

              <TimeDivider time="æ˜¨å¤© 08:00" />
              <ChatMessage type="sent" content="ä¸ä¼šæ˜¯å‡ºäº‹äº†å§â€¦â€¦" />
            </div>
            <div class="input-area">
              <textarea placeholder="è¾“å…¥æ¶ˆæ¯..."></textarea>
              <button class="send-btn">å‘é€</button>
            </div>
          </div>
        </div>

        <!-- ç™»å½• tab -->
        <div id="loginTab" :class="['tab-content', { active: activeTab === 'loginTab' }]">
          <div class="login-container">
            <!-- å·²ç™»å½•çŠ¶æ€ -->
            <div id="loggedInView" :class="['login-view', { active: loginView === 'loggedIn' }]">
              <div class="username">zhuzhuxia</div>
              <button class="logout-btn" @click="showLoginForm">é€€å‡ºç™»å½•</button>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <div id="loginFormView" :class="['login-view', { active: loginView === 'loginForm' }]">
              <h2>OOç™»å½•</h2>
              <div class="input-group">
                <input type="text" v-model="username" placeholder="ç”¨æˆ·å" />
              </div>
              <div class="input-group">
                <input type="password" v-model="password" placeholder="å¯†ç " />
              </div>
              <button class="login-btn" @click="login">ç™»å½•</button>
              <button class="back-to-logged" @click="showLoggedInView">â† è¿”å›</button>
            </div>
          </div>
        </div>

        <!-- è¯´è¯´ tab -->
        <div id="shuoshuoTab" :class="['tab-content', { active: activeTab === 'shuoshuoTab' }]">
          <div class="shuoshuo-list">
            <div class="shuoshuo-item">
              <div class="shuoshuo-header">
                <div class="avatar">ğŸ–</div>
                <div class="user-info">
                  <div class="name">çŒªçŒªä¾ </div>
                  <div class="time">11/15 22:30</div>
                </div>
              </div>
              <div class="shuoshuo-content">
                ä»Šå¤©æ‰“é‡å¾ˆç»™åŠ›ï¼
              </div>
              <div class="shuoshuo-stats">
                <span>ğŸ‘ <b>{{ Math.floor(Math.random() * 20) + 5 }}</b></span>
                <span>ğŸ’¬ <b>{{ Math.floor(Math.random() * 10) + 1 }}</b></span>
                <span>ğŸ” <b>{{ Math.floor(Math.random() * 5) }}</b></span>
              </div>
            </div>
            <div class="shuoshuo-item">
              <div class="shuoshuo-header">
                <div class="avatar">ğŸ–</div>
                <div class="user-info">
                  <div class="name">çŒªçŒªä¾ </div>
                  <div class="time">10/11 12:20</div>
                </div>
              </div>
              <div class="shuoshuo-content">
                å¤–å–å‘˜åˆé€é”™äº†â€¦â€¦æ˜æ˜å‘¨å›´ä¹Ÿæ²¡å‡ æˆ·äººå®¶â€¦â€¦
              </div>
              <div class="shuoshuo-stats">
                <span>ğŸ‘ <b>{{ Math.floor(Math.random() * 20) + 5 }}</b></span>
                <span>ğŸ’¬ <b>{{ Math.floor(Math.random() * 10) + 1 }}</b></span>
                <span>ğŸ” <b>{{ Math.floor(Math.random() * 5) }}</b></span>
              </div>
            </div>
            <div class="shuoshuo-item">
              <div class="shuoshuo-header">
                <div class="avatar">ğŸ–</div>
                <div class="user-info">
                  <div class="name">çŒªçŒªä¾ </div>
                  <div class="time">09/11 15:40</div>
                </div>
              </div>
              <div class="shuoshuo-content">
                äº”æ’æœ‰æ— ï¼Œç¼º3
              </div>
              <div class="shuoshuo-stats">
                <span>ğŸ‘ <b>{{ Math.floor(Math.random() * 20) + 5 }}</b></span>
                <span>ğŸ’¬ <b>{{ Math.floor(Math.random() * 10) + 1 }}</b></span>
                <span>ğŸ” <b>{{ Math.floor(Math.random() * 5) }}</b></span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- åº•éƒ¨å¯¼èˆªæ  -->
      <div class="bottom-nav">
        <div :class="['nav-item', { active: activeTab === 'loginTab' }]" @click="switchTab('loginTab')">ç™»å½•</div>
        <div :class="['nav-item', { active: activeTab === 'shuoshuoTab' }]" @click="switchTab('shuoshuoTab')">è¯´è¯´</div>
        <div :class="['nav-item', { active: activeTab === 'chatTab' }]" @click="switchTab('chatTab')">èŠå¤©</div>
      </div>
  </PhoneFrame>
</template>

<script>
import PhoneFrame from '../components/PhoneFrame.vue'
import ChatMessage from '../components/ChatMessage.vue'
import TimeDivider from '../components/TimeDivider.vue'
import mimatuImage from '../assets/mimatu.jpg'

const CORRECT_PASSWORD = "20000825"
const CORRECT_USERNAME = "aishuijiaodeshuijiao"

export default {
  name: 'ChatView',
  components: {
    PhoneFrame,
    ChatMessage,
    TimeDivider
  },
  data() {
    return {
      currentTime: '9:41',
      activeTab: 'chatTab',
      currentView: 'contactList',
      loginView: 'loggedIn',
      username: '',
      password: '',
      mimatuImage,
      timeInterval: null
    }
  },
  mounted() {
    this.updateTime()
    this.timeInterval = setInterval(this.updateTime, 60000)
  },
  beforeUnmount() {
    if (this.timeInterval) {
      clearInterval(this.timeInterval)
    }
  },
  methods: {
    updateTime() {
      const now = new Date()
      const hours = String(now.getHours()).padStart(2, '0')
      const minutes = String(now.getMinutes()).padStart(2, '0')
      this.currentTime = `${hours}:${minutes}`
    },
    switchTab(tabId) {
      this.activeTab = tabId
      if (tabId === 'chatTab') {
        this.currentView = 'contactList'
      }
    },
    openChat() {
      this.currentView = 'chatView'
    },
    goBackToContacts() {
      this.currentView = 'contactList'
    },
    goBackToPhone() {
      this.$router.push('/myphone')
    },
    showLoginForm() {
      this.loginView = 'loginForm'
      this.username = ''
      this.password = ''
    },
    showLoggedInView() {
      this.loginView = 'loggedIn'
    },
    login() {
      const user = this.username.trim()
      const pass = this.password

      // å…è®¸ç›´æ¥åˆ‡æ¢å›çŒªçŒªä¾ ï¼ˆæ— å¯†ç ï¼‰
      if (user === 'zhuzhuxia' || user === 'çŒªçŒªä¾ ' || user === '') {
        this.showLoggedInView()
        return
      }

      // éªŒè¯æ°´é¥ºè´¦å·
      if (user === CORRECT_USERNAME) {
        if (!pass) {
          alert('è¯·è¾“å…¥å¯†ç ')
          return
        }
        if (pass === CORRECT_PASSWORD) {
          alert('ç™»å½•æˆåŠŸï¼')
          this.$router.push('/chat2')
        } else {
          alert('å¯†ç é”™è¯¯')
        }
        return
      }

      // éªŒè¯ç”µè„‘é«˜æ‰‹è´¦å·
      if (user === 'diannaogaoshou') {
        if (!pass) {
          alert('è¯·è¾“å…¥å¯†ç ')
          return
        }
        if (pass === '20020321') {
          alert('ç™»å½•æˆåŠŸï¼')
          this.$router.push('/otherchat')
        } else {
          alert('å¯†ç é”™è¯¯')
        }
        return
      }

      alert('æ— æ­¤ç”¨æˆ·')
    }
  }
}
</script>

<style scoped>
/* å…¨å±€é‡ç½® */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Microsoft YaHei", "Segoe UI", sans-serif;
}

/* æ‰‹æœºå®¹å™¨æ ·å¼å·²ç§»è‡³ PhoneFrame ç»„ä»¶ */

.main-content {
  flex: 1;
  overflow: hidden;
  position: relative;
}

/* Tab å’Œå­è§†å›¾ */
.tab-content,
.sub-view {
  display: none;
  height: 100%;
  flex-direction: column;
}

.tab-content.active,
.sub-view.active {
  display: flex;
}

/* ====== è”ç³»äººåˆ—è¡¨ ====== */
.header {
  height: 50px;
  background: rgba(18, 150, 219, 0.9);
  display: flex;
  align-items: center;
  padding: 0 15px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  position: relative;
}

.back-to-phone-btn {
  background: rgba(255, 255, 255, 0.2);
  border: none;
  color: white;
  font-size: 0.9rem;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  margin-right: 10px;
  transition: background 0.2s;
}

.back-to-phone-btn:hover {
  background: rgba(255, 255, 255, 0.3);
}

.header h2 {
  font-size: 1.1rem;
  font-weight: bold;
  color: white;
}

.contact-list {
  flex: 1;
  background: white;
  color: #333;
}

.contact-item {
  display: flex;
  padding: 15px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  transition: background 0.2s;
}

.contact-item:hover {
  background: #f9f9f9;
}

.avatar {
  width: 50px;
  height: 50px;
  border-radius: 8px;
  background: #e0e0e0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  margin-right: 15px;
  flex-shrink: 0;
}

.contact-info .name {
  font-weight: bold;
  font-size: 1rem;
  color: #333;
  margin-bottom: 4px;
}

.contact-info .last-message {
  font-size: 0.9rem;
  color: #888;
}

/* ====== èŠå¤©ç•Œé¢ ====== */
.chat-header {
  height: 50px;
  background: rgba(18, 150, 219, 0.9);
  color: white;
  display: flex;
  align-items: center;
  padding: 0 15px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.back-btn {
  background: none;
  border: none;
  color: white;
  font-size: 1.5rem;
  cursor: pointer;
  width: 30px;
  text-align: center;
}

.contact-name {
  font-weight: bold;
  font-size: 1rem;
  margin-left: 10px;
}

.chat-container {
  flex: 1;
  padding: 15px;
  padding-bottom: 140px; /* ç»™ç»å¯¹å®šä½çš„è¾“å…¥åŒºç•™æ›´å……è¶³ç©ºé—´ï¼Œé˜²æ­¢æ¶ˆæ¯è¢«é®æŒ¡ */
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* æ¶ˆæ¯æ ·å¼å·²ç§»è‡³ ChatMessage ç»„ä»¶ */

.input-area {
  background: white;
  padding: 10px;
  display: flex;
  gap: 8px;
  border-top: 1px solid #ddd;
  position: absolute; /* å›ºå®šåœ¨è§†å›¾åº•éƒ¨ä¸Šæ–¹ */
  left: 0;
  right: 0;
  bottom: 50px; /* ç´§è´´åº•éƒ¨å¯¼èˆªï¼ˆé«˜åº¦ 50pxï¼‰ */
  z-index: 60; /* æå‡è¾“å…¥æ¡†å±‚çº§ï¼Œæ˜¾ç¤ºåœ¨å¯¼èˆªæ ä¸Šæ–¹ */
}

.input-area textarea {
  flex: 1;
  height: 40px;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 20px;
  resize: none;
  font-size: 0.95rem;
}

.input-area .send-btn {
  width: 60px;
  background: #1296db;
  color: white;
  border: none;
  border-radius: 20px;
  font-weight: bold;
  cursor: pointer;
}

/* ====== åº•éƒ¨å¯¼èˆªæ  ====== */
.bottom-nav {
  display: flex;
  background: rgba(255, 255, 255, 0.95);
  height: 50px;
  position: absolute;
  bottom: 0;
  width: 100%;
  border-top: 1px solid rgba(255, 255, 255, 0.3);
  z-index: 50; /* ä¿æŒä½äºè¾“å…¥æ¡† */
}

.nav-item {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.9rem;
  color: #999;
  cursor: pointer;
  transition: color 0.2s;
}

.nav-item.active {
  color: #1296db;
  font-weight: bold;
}

/* ====== ç™»å½•é¡µæ ·å¼ ====== */
.login-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  padding: 30px;
  color: white;
}

.login-view {
  display: none;
  width: 100%;
  max-width: 300px;
}

.login-view.active {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 25px;
}

.user-info {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}

.username {
  font-size: 1.3rem;
  font-weight: bold;
  color: white;
}

.logout-btn,
.login-btn,
.back-to-logged {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: bold;
  cursor: pointer;
  transition: opacity 0.2s;
}

.logout-btn {
  background: rgba(255, 255, 255, 0.2);
  color: white;
}

.logout-btn:hover {
  background: rgba(255, 255, 255, 0.3);
}

.login-btn {
  background: #1296db;
  color: white;
}

.back-to-logged {
  background: none;
  color: white;
  margin-top: 10px;
  text-decoration: underline;
}

.input-group {
  width: 100%;
}

.input-group input {
  width: 100%;
  padding: 12px;
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.1);
  color: white;
  font-size: 1rem;
}

.input-group input::placeholder {
  color: rgba(255, 255, 255, 0.6);
}

/* ====== è¯´è¯´é¡µæ ·å¼ ====== */
.shuoshuo-list {
  padding: 15px;
  height: 100%;
  overflow-y: auto;
}

.shuoshuo-item {
  background: white;
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 15px;
  color: #333;
}

.shuoshuo-header {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
}

.shuoshuo-header .avatar {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  background: #e0e0e0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  margin-right: 10px;
}

.user-info .name {
  font-weight: bold;
  font-size: 1rem;
}

.user-info .time {
  font-size: 0.85rem;
  color: #888;
}

.shuoshuo-content {
  font-size: 1rem;
  line-height: 1.5;
  margin-bottom: 12px;
  word-break: break-word;
}

.shuoshuo-stats {
  display: flex;
  gap: 20px;
  font-size: 0.9rem;
  color: #666;
  border-top: 1px solid #eee;
  padding-top: 10px;
}

/* æ—¶é—´åˆ†éš”çº¿æ ·å¼å·²ç§»è‡³ TimeDivider ç»„ä»¶ */
/* page-wrapper æ ·å¼å·²ç§»è‡³ PhoneFrame ç»„ä»¶ */
</style>

